%\documentclass[a4paper,10.5pt]{report}
\documentclass[a4paper,10.5pt]{article}

\usepackage{booktabs}
\usepackage{epsfig}
\usepackage{amsmath}
\usepackage{rotating}

% Title Page
\textwidth 15 true cm
\textheight 25 true cm
%\headheight  14pt
%\headsep    16pt
%\footskip   27pt
%\marginparsep 10pt
%\marginparwidth  100pt
\def\marginset#1#2{
\setlength{\oddsidemargin}{#1}
\iffalse
\reversemarginpar
\addtolength{\oddsidemargin}{\marginparsep}
\addtolength{\oddsidemargin}{\marginparwidth}
\fi

  \setlength{\evensidemargin}{0mm}
\iffalse
\addtolength{\evensidemargin}{\marginparsep}
\addtolength{\evensidemargin}{\marginparwidth}
\fi

  % \paperwidth = h + \oddsidemargin+\textwidth+\evensidemargin + h
\setlength{\hoffset}{\paperwidth}
\addtolength{\hoffset}{-\oddsidemargin}
\addtolength{\hoffset}{-\textwidth}
\addtolength{\hoffset}{-\evensidemargin}
\setlength{\hoffset}{0.5\hoffset}
\addtolength{\hoffset}{-1in}           % h = \hoffset + 1in

  \setlength{\voffset}{-1in}             % 0 = \voffset + 1in
\setlength{\topmargin}{\paperheight}
\addtolength{\topmargin}{-\headheight}
\addtolength{\topmargin}{-\headsep}
\addtolength{\topmargin}{-\textheight}
\addtolength{\topmargin}{-\footskip}
\addtolength{\topmargin}{#2}
\setlength{\topmargin}{0.5\topmargin}
}

\marginset{10mm}{12mm}
\title{Trigger Cuts and Efficiencies for E08014 experiment}
\author{Zhihong Ye\\
 University of Virginia
}

\begin{document}
\maketitle

\section{Trigger Setup}

  The Hall A triggers are generated when particles go through detectors located in the detector hut of High Resolution Spectrometers (HRS). The traditional single arm trigger requires both S1 and S2m scintillator planes fired in a narrow overlap time window. During E08014 experiment, the gas Cerenkov detector plane (GC)was added in the main trigger to exclude most of pions events, which dramatically reduced the total events rate. New types of main triggers are the coincidence of logic signals for S1, S2m and GC (we still call them as T1 and T3, but they are 3 out of 3 triggers). We still kept the original triggers but gave them different names, T6 and T7 respectively, but we kept their events rate as low as 50Hz by setting big prescale factors.

 There are also two other triggers, T2 for HRS-R and T4 for HRS-L, which are used for trigger efficiency study. T2 and T4 are so-called 2 out of 3 triggers, which mean that only one of two scintillator planes is fired and coincides with a third detector plane, which is GC detector for our experiment. T2 and T4 triggers are generated by sending logic signals from S1, S2m and Cerenkov into a programable module,called MLU \footnote{For more detail about Hall A trigger design, visit http:\/\/hallaweb.jlab.org\/equipment\/daq\/trigsetup\_2003.html}.

 Ideally, before the prescaling, T6(T7) should be exactly the same as T1(T3),if the GC has 100\% of detection efficiency and very clean background. However, T6(T7) has much higher event rates than T1(T3), due to pion contamination and accidental coincidences between noise signals from Cerenkov (and its corresponding electronic modules) and real signals detected by S1 and S2m. We still need to record the events from T6(T7) for GC detection efficiency study. During the data collection, we applied prescale factors on triggers to control their rates to a certain amount. T1 and T3 are the major production triggers so we tried to keep their rate as high as possible unless the dead time is getting high simultaneously. T3, T4,T6 and T7 are prescaled to fix their rates at about 50 \~ 100Hz.

\section{Cuts}

\begin{table}[htbp]
 \begin{tabular}{lcccccccc}
 \toprule
 Trigger:       &    T1   &   T2   &   T3   &   T4   &   T5   &   T6   &   T7   &   T8\\
 \midrule
 TDC Channel:   &     1   &    2   &    3   &    4   &    5   &    6   &    7   &    8\\
 Decimal:       &     2   &   $2^{2}$   &    $2^{3}$   &   $2^{4}$   &   $2^{5}$   &  $2^{6}$  &   $2^{7}$  &   $2^{8}$\\
 Hex:           &    0x02 &   0x04 &   0x08 &   0x10 &  0x20  &  0x40  &  0x80  &  0x100\\
 \bottomrule
 \end{tabular}
% \centering
\caption{Triggers and their corresponding data types in data stream}
\label{trigger_table}
\end{table}

 There are totally 12 different triggers connected to Trigger Supervisor (TS) and when any of those triggers forms a level one accept signal in the TS and hence generate a gate, those triggers  will be recorded into a TDC on channels from 1 to 12 \emph{AFTER} prescaling. The analyzer decodes those values as Hex types and issues a name called "DBB.evtypebits". For our experiment, we are only interested in T1,T2,T3,T4,T6,and T7. Table~\ref{trigger_table} give triggers and their corresponding values in different number types.

 As long as we understand the corresponding values of all trigger types in the data stream, applying certain types of cuts will select events coming from different triggers. There are several kinds of trigger cuts used during data analysis and we need to understand the differences in between them:
 \begin{enumerate}
\item \textbf{DBB.evtypebits=0x02}: \\
 Only T1 trigger and no other trigger types co-exist.
\item \textbf{(DBB.evtypebits\&0x02)==0x02}: \\
    T1 trigger but don't care whether other trigger types co-exist or not.
\item \textbf{DBB.evtypebits$\gg1$\&1}: \\
    This cut is the same as (2).
\item \textbf{DBB.evtypebits \&(1$\gg$1)}: \\
    Exactly the same as (2) and (3), but SCALE a histogram by $2^{N}$ times. (We need to be careful when using this cut to plot a histogram together with other histogram which cuts on different trigger type.)

\emph{Bob recommends NOT to use the following two trigger types:}
\item \textbf{DBB.evtype==1}: \\
     Select events only triggered by T1,and no other trigger present within 5ms window when the TS registers an event.This is almost the same as (1) but there is a slight difference and the reason is unknown. (For our case, most of time, if we have T1, certainly we should have T6, unless Cerenkov trigger has inefficiency, so we should avoid to use this cuts).
\item \textbf{fEvtHdr.fEvtType==1}:\\
     Exactly the same as (5)
\end{enumerate}

\section{Trigger Events}

 %\clearpage
\begin{figure}[htb]
\centerline{\psfig{figure=figures/trigger_region.eps,scale=0.3,angle=0,clip=,keepaspectratio}}
\caption[A scheme of events with different Trigger cuts]{\footnotesize{A scheme of events with different Trigger cuts}
\label{trig_region}}
\end{figure}

  Not all events are recorded by DAQ because the detectors do not have 100\% detection efficiencies and some events are skipped due to the prescaling. And when applying PID cuts, some good events can also be removed due to the cut efficiencies. To calculate the cross section, we need to know the percentage of events we lose.

  Fig~\ref{trig_region} shows a box of which area denotes the total electrons pass through S1, S2m and GC in HRS-R, including events firing or not firing GC. We assume all detectors except GC have 100\% detection efficiencies and there is no pions contaimination. The area of Region 1 gives the number of electrons ($N_{1}$) with cut on T1 only, which means that those electrons are recorded when S1,S2m and GC are all fired and T1 trigger is prescaled. Region 2 gives the total number of event ($N_{2}$) when they trigger S1 and S2m but not GC, after T6 prescaled. Region 3 indicates the case when T1 and T6 are co-existed in one event ($N_{3}$). Region 4 and Region 5 show that the number of electrons ($N_{4}$ and $N_{5}$) being prescaled out by prescale factor PS6 and PS1, respectively. So there are simply relationship between number of electrons in those regions and prescale factors:

 \begin{equation}
 PS1 = \frac{N_{1}+N_{3}+N_{5}}{N_{1}+N_{3}},  PS6 = \frac{N_{1}+N_{2}+N_{3}+N_{4}+N_{5}}{N_{2}+N_{3}}=\frac{N_{2}+N_{4}}{N_{2}},
\end{equation}
 where $N_{1}$, $N_{2}$ and $N_{3}$ can be extracted from data by applying Trigger cuts:

\begin{table}[htbp]
 \begin{tabular}{lcc}
\toprule
 Events  &  Cut\\
\midrule
$N_{1}$  &  \textbf{DBB.evtypebits$\gg1\&1$\&\&!(DBB.evtypebits$\gg6\&1$)} \\
$N_{2}$  &  \textbf{DBB.evtypebits$\gg6\&1$\&\&!(DBB.evtypebits$\gg1\&1$)} \\
$N_{3}$  &  \textbf{DBB.evtypebits$\gg1\&1$\&\&DBB.evtypebits$\gg6\&1$}  \\
$N_{1}+N_{3}$  &  \textbf{DBB.evtypebits$\gg1\&1$}  \\
$N_{2}+N_{3}$  &  \textbf{DBB.evtypebits$\gg6\&1$}  \\
\bottomrule
  \end{tabular}
\end{table}
To avoid double counting issue, we need to exactly follow the cuts in the table above to get the number of electrons for specific trigger type.

Mathematically, if the prescale factors are known, we can calculate the total number of electrons in the box by the formula below:
\begin{equation}
 N_{0} = N_{1}+N_{2}+N_{3}+N_{4}+N_{5}=PS6\times(N_{2}+N_{3}).
\end{equation}

However, T6 is prescaled to keep the trigger rate as low as 50Hz so the statistical fluctuation of $N_{2}+N_{3}$ is very big, and in reality, events from T6 contain most of pions. Instead, we should calculate $N_{4}$ and $N_{5}$, and combine with $N_{1}$ to get total number of electrons in that box:
\begin{equation}
 N_{0} = N_{1}+N_{2}+N_{3}+N_{4}+N_{5}=PS1\times(N_{1}+N_{3})+PS6\times N_{2}.
\label{event0_1}
\end{equation}
 The first term of Eq~\ref{event0_1} is the portion of electrons that fire GC, while the second term is the portion of electrons that do not fire the detector. Since the total number of electrons is components of events from T1 and T6, we might worry about whether they hold different detection efficiencies or not. Actually we can do further simplification.

\begin{figure}[htb]
\centerline{\psfig{figure=figures/trigger_region2.eps,scale=0.3,angle=0,clip=,keepaspectratio}}
\caption[Another scheme of electrons with different Trigger cuts]{\footnotesize{Another scheme of electrons with different Trigger cuts}
\label{trig_region2}}
\end{figure}
If we look at the Fig~\ref{trig_region2}, where we define a new region call Region 4' with number of electrons $N_{4'}$, we find a new relationship:
\begin{equation}
\frac{N_{4'}}{N_{1}}=\frac{N_{2}}{N_{3}},
\end{equation}
and,
\begin{equation}
N_{2}+N{4} = PS6\times N_{2} = PS1\times(N_{2}+N{4'}) = PS1\times(N_{2}+N_{1}N_{2}/N_{3}).
\end{equation}
So we find a relationship between PS1 and PS6:
\begin{equation}
 PS6 = PS1(1+N_{1}/N_{3}).
\end{equation}

 So PS6 can be substituted by the formula above, and Eq~\ref{event0_1} becomes:
\begin{equation}
 N_{0} = PS1\times(N_{1}+N_{3})\times \frac{N_{2}+N_{3}}{N_{3}}=\frac{PS1\times(N_{1}+N_{3})}{\epsilon},
\label{event0_2}
\end{equation}
where $\epsilon=\frac{N_{3}}{N_{2}+N_{3}}$ is the percentage of electrons firing GC when they pass through the detector, which exactly is the definition of GC detection efficiency\footnote{The typical way to get the detection efficiency of GC is applying a tight cut on Calorimeter to sample out pure electrons and counting how many of them GC detect: 
\begin{equation}
 \epsilon_{detection}^{GC}=\frac{N_{GC}}{N_{Calorimeter}}.
\end{equation}
Basically those two definition should give the same results but we need to do further check.
}!

 $N_{0}$ now becomes straightforward: the total number of electrons is equal to the number of events triggered by S1,S2m and GC, and corrected by the inefficiency of GC, remembering that we assume all other detectors have 100\% efficiencies. To get the final total number of electrons passing thought all detectors, we need to calculate the tracking efficiency of VDC, trigger efficiency of S1 and S2m,detection efficiency of GC and Calorimeters, and the PID cut efficiencies. Most of detectors' efficiencies have been studied in other chapters, so here we just focus on the trigger efficiency.

\section{Trigger Efficiency}
 As we discussed at the beginning, there are two triggers T2 and T4, which is designed for trigger efficiency study. T2(T4) requires only one of S1 and S2m is fired and coincides with trigger signal from GC, so it picks up the portion of electrons that are missed by S1 or S2m, of cause, after prescaling. The traditional way of defining trigger efficiency for HRS-R can be written as:
 \begin{equation}
 \epsilon_{trigger} = \frac{N_{0}}{N_{0}+PS2\times N_{T2}},
 \label{trigger_eff1}
\end{equation}
where $N_{T2}$ can be extracted by applying cuts \textbf{DBB.evtypebits=0x04}. Here we need to be very careful about calculating the trigger efficiency, since electrons triggered by GC should carry the effect of GC detection inefficiency. In the Eq~\ref{trigger_eff1}, $N_{T2}$ involves GC trigger so it should carry the detection efficiency of GC, and if we put the result of $N_{0}$ from Eq~\ref{event0_2}, we actually can cancel out the GC detection efficiency\footnote{The traditional Hall A single arm trigger only involves S1 and S2m, which does not have the effect of GC inefficiency, so the trigger efficiency should tangle together with GC detection efficiency:
\begin{equation}
 \epsilon_{trigger} = =\frac{PS1\times(N_{1}+N_{3})}{PS1\times(N_{1}+N_{3})+PS2\times N_{T2}/\epsilon_{detection}^{GC}}.
\end{equation}
Hence for previous Hall A experiments, the calculation of trigger efficiency should be incorrect, but since GC always has very high efficiency and trigger rate from T2 is low comparing with T1, the values should not have too much difference.}:

\begin{equation}
 \epsilon_{trigger} = \frac{PS1\times(N_{1}+N_{3})/\epsilon_{detection}^{GC}}{PS1\times(N_{1}+N_{3})/\epsilon_{detection}^{GC}+PS2\times N_{T2}/\epsilon_{detection}^{GC}}=\frac{PS1\times(N_{1}+N_{3})}{PS1\times(N_{1}+N_{3})+PS2\times N_{T2}}.
\end{equation}

 The GC detection efficiency will be introduced when we apply PID cut on GC to select elections. So the final total number of electrons that pass through the detectors is given by:
\begin{equation}
 N_{total} = \frac{N_{0}}{\epsilon_{trigger}\ast\epsilon_{tracking}\ast\epsilon_{detection}^{GC}\ast\epsilon_{detection}^{Calo}\ast\epsilon_{PID}^{GC}\ast\epsilon_{PID}^{Calo}}.
\end{equation}

The results above should hold when we study triggers and electrons at HRS-L.

\end{document}

